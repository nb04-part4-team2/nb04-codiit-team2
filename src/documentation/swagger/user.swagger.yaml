# ========================================
# User API Swagger Documentation
# ========================================
# 작성일: 2025-01-05
# 도메인: User - 사용자 관리
# 총 5개 엔드포인트
#
# 엔드포인트:
# - POST   /api/users - 회원가입
# - GET    /api/users/me - 내 정보 조회
# - PATCH  /api/users/me - 내 정보 수정
# - DELETE /api/users/me - 회원 탈퇴
# - GET    /api/users/me/addresses - 주소 목록 조회
#
# 특징:
# - BUYER/SELLER 타입 구분
# - 사용자 등급 시스템 (구매 금액 기반)
# - 포인트 관리
# - 테스트 계정 보호 시스템
# ========================================

paths:
  /api/users:
    post:
      tags:
        - User
      summary: 회원가입
      description: |
        새로운 사용자를 등록합니다.

        인증 불필요:
        Public API (누구나 접근 가능)

        테스트 계정 (이미 제공됨):
        구매자: `buyer@codiit.com` / `test1234`
        판매자: `seller@codiit.com` / `test1234`
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - email
                - password
                - type
              properties:
                name:
                  type: string
                  minLength: 1
                  example: "김유저"
                email:
                  type: string
                  format: email
                  example: "user01@example.com"
                password:
                  type: string
                  format: password
                  minLength: 8
                  example: "password123"
                type:
                  type: string
                  enum: [BUYER, SELLER]
                  example: "BUYER"
      responses:
        '201':
          description: 회원 가입 성공한 유저의 값을 반환
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    description: 사용자 고유 ID
                    example: "cm1abc123def456ghi789jkl"
                  name:
                    type: string
                    example: "김유저"
                  email:
                    type: string
                    example: "email@example.com"
                  type:
                    type: string
                    example: "BUYER"
                  points:
                    type: integer
                    example: 0
                  createdAt:
                    type: string
                    format: date-time
                    example: "2025-05-29T06:00:41.976Z"
                  updatedAt:
                    type: string
                    format: date-time
                    example: "2025-05-29T06:00:41.976Z"
                  grade:
                    type: object
                    properties:
                      id:
                        type: string
                        example: "grade_green"
                      name:
                        type: string
                        example: "green"
                      rate:
                        type: number
                        example: 1
                      minAmount:
                        type: integer
                        example: 0
                  image:
                    type: string
                    nullable: true
                    example: "https://codiit-images.s3.ap-northeast-2.amazonaws.com/user-profile-sample.jpg"
        '400':
          description: 유효성 검증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: "유효성 검증에 실패했습니다."
                details:
                  - field: "password"
                    message: "비밀번호는 `8`자 이상이어야 합니다."
        '409':
          description: 이미 존재하는 유저
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: "이미 존재하는 이메일입니다."
                details: []

  /api/users/me:
    get:
      tags:
        - User
      summary: 내 정보 조회
      description: |
        로그인한 사용자의 정보를 조회합니다.

        인증 필요:
        `Bearer 토큰 필수`
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 사용자 정보 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    description: 사용자 고유 ID
                    example: "cm2xyz789abc012def345ghi"
                  name:
                    type: string
                    example: "테스트구매자"
                  email:
                    type: string
                    example: "buyer@codiit.com"
                  type:
                    type: string
                    example: "BUYER"
                  points:
                    type: integer
                    example: 50000
                  createdAt:
                    type: string
                    format: date-time
                    example: "2025-05-29T06:00:41.976Z"
                  updatedAt:
                    type: string
                    format: date-time
                    example: "2025-05-29T06:00:41.976Z"
                  grade:
                    type: object
                    properties:
                      id:
                        type: string
                        example: "grade_red"
                      name:
                        type: string
                        example: "red"
                      rate:
                        type: number
                        example: 5
                      minAmount:
                        type: integer
                        example: 300000
                  image:
                    type: string
                    nullable: true
                    example: "https://codiit-images.s3.ap-northeast-2.amazonaws.com/user-profile-sample.jpg"
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: "인증 토큰이 필요합니다."
                details: []

    patch:
      tags:
        - User
      summary: 내 정보 수정
      description: |
        로그인한 사용자의 정보를 수정합니다.

        인증 필요:
        `Bearer 토큰 필수`

        테스트 계정은 수정할 수 없습니다.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - currentPassword
              properties:
                name:
                  type: string
                  minLength: 1
                  example: "김유저수정"
                password:
                  type: string
                  format: password
                  minLength: 8
                  example: "newpassword123"
                currentPassword:
                  type: string
                  format: password
                  example: "oldpassword123"
                imageUrl:
                  type: string
                  format: uri
                  example: "https://codiit-images.s3.ap-northeast-2.amazonaws.com/user-profile-sample.jpg"
      responses:
        '200':
          description: 사용자 정보 수정 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    description: 사용자 고유 ID
                    example: "cm3pqr456stu789vwx012yza"
                  name:
                    type: string
                    example: "김유저수정"
                  email:
                    type: string
                    example: "user@example.com"
                  type:
                    type: string
                    example: "BUYER"
                  points:
                    type: integer
                    example: 150000
                  createdAt:
                    type: string
                    format: date-time
                    example: "2025-05-29T06:00:41.976Z"
                  updatedAt:
                    type: string
                    format: date-time
                    example: "2025-05-29T06:00:41.976Z"
                  grade:
                    type: object
                    properties:
                      id:
                        type: string
                        example: "grade_orange"
                      name:
                        type: string
                        example: "orange"
                      rate:
                        type: number
                        example: 3
                      minAmount:
                        type: integer
                        example: 100000
                  image:
                    type: string
                    nullable: true
                    example: "https://codiit-images.s3.ap-northeast-2.amazonaws.com/user-profile-sample.jpg"
        '400':
          description: 유효성 검증 실패 또는 수정할 내용 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: "수정할 내용이 없습니다."
                details: []
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: "인증 토큰이 필요합니다."
                details: []
        '403':
          description: 현재 비밀번호 불일치 또는 테스트 계정 보호
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                wrongPassword:
                  value:
                    message: "현재 비밀번호가 일치하지 않습니다."
                    details: []
                testAccount:
                  value:
                    message: "테스트 계정은 수정/삭제할 수 없습니다."
                    details: []

  /api/users/delete:
    delete:
      tags:
        - User
      summary: 회원 탈퇴
      description: |
        로그인한 사용자의 계정을 삭제합니다.

        인증 필요:
        `Bearer 토큰 필수`

        테스트 계정은 삭제할 수 없습니다.
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 회원 탈퇴 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "회원 탈퇴가 완료되었습니다."
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: "인증 토큰이 필요합니다."
                details: []
        '403':
          description: 테스트 계정 보호
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: "테스트 계정은 수정/삭제할 수 없습니다."
                details: []

  /api/users/me/likes:
    get:
      tags:
        - User
      summary: 찜한 스토어 목록 조회
      description: |
        로그인한 사용자가 찜한 스토어 목록을 조회합니다.

        인증 필요:
        `Bearer 토큰 필수`
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 찜한 스토어 목록 조회 성공
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    store:
                      type: object
                      properties:
                        id:
                          type: string
                          example: "cmjtkn0td0017p701tp5nwslg"
                        userId:
                          type: string
                          example: "cmjthper90001p7017spnm7y5"
                        name:
                          type: string
                          example: "코디잇 패션스토어"
                        address:
                          type: string
                          example: "서울시 강남구"
                        phoneNumber:
                          type: string
                          example: "010-1234-5678"
                        content:
                          type: string
                          example: "트렌디한 아이템을 합리적인 가격에 제공합니다"
                        image:
                          type: string
                          nullable: true
                          example: "https://codiit-images.s3.ap-northeast-2.amazonaws.com/b07c0e43-44c0-47a0-8ff7-195059310fb8.jpeg"
                        createdAt:
                          type: string
                          format: date-time
                          example: "2025-12-31T05:24:20.066Z"
                        updatedAt:
                          type: string
                          format: date-time
                          example: "2025-12-31T05:25:09.150Z"
                        detailAddress:
                          type: string
                          nullable: true
                          example: "반구정1안길 49"
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: "인증 토큰이 필요합니다."
                details: []
