# ========================================
# Payment API Swagger Documentation
# ========================================
# 작성일: 2026-01-11
# 도메인: Payment - 결제 관리
# 총 2개 엔드포인트
#
# 엔드포인트:
# - POST /api/payment - 결제 생성
# - POST /api/payment/webhooks/portone - 포트원 결제 콜백
# ========================================

paths:
  /api/payment:
    post:
      tags:
        - Payment
      summary: 결제 생성
      description: |
        새로운 결제를 생성합니다.

        인증 필요:
        `Bearer 토큰 필수`

        권한:
        `BUYER` 전용
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - orderId
                - provider
                - method
              properties:
                orderId:
                  type: string
                  description: '주문 고유 ID'
                  example: 'cm7order123abc456def789'
                provider:
                  type: string
                  enum:
                    - kakaopay
                  description: '결제 서비스 제공자'
                  example: 'kakaopay'
                method:
                  type: string
                  enum:
                    - card
                    - point
                    - kakaopay
                  description: '결제 수단'
                  example: 'card'
      responses:
        '201':
          description: 결제 생성 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    description: '결제 고유 ID'
                    example: 'cm7payment789xyz012abc'
                  price:
                    type: integer
                    description: '결제 금액'
                    example: 145000
                  createdAt:
                    type: string
                    format: date-time
                    example: '2026-01-11T10:30:00.000Z'
        '400':
          description: 유효성 검증 실패
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: '유효성 검증에 실패했습니다.'
                  details:
                    type: array
                    items: {}
                    example: []
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: '인증이 필요합니다.'
                  details:
                    type: array
                    items: {}
                    example: []
        '403':
          description: 권한 없음
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: '권한이 없습니다.'
                  details:
                    type: array
                    items: {}
                    example: []
        '404':
          description: 주문을 찾을 수 없음
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: '주문을 찾을 수 없습니다.'
                  details:
                    type: array
                    items: {}
                    example: []

  /api/payment/webhooks/portone:
    post:
      tags:
        - Payment
      summary: 포트원 결제 웹훅 콜백
      description: |
        포트원으로부터 결제 상태 변경에 대한 웹훅을 수신합니다.
        이 엔드포인트는 서버 간 통신에 사용되며, 클라이언트가 직접 호출하지 않습니다.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - imp_uid
                - merchant_uid
              properties:
                imp_uid:
                  type: string
                  description: '포트원 결제 고유 ID'
                  example: 'imp_1234567890'
                merchant_uid:
                  type: string
                  description: '가맹점 주문 고유 ID (결제 ID)'
                  example: 'cm7payment789xyz012abc'
      responses:
        '200':
          description: 웹훅 수신 성공
          content:
            application/json:
              schema:
                type: string
                example: 'OK'
        '400':
          description: 유효성 검증 실패
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: '유효성 검증에 실패했습니다.'
                  details:
                    type: array
                    items: {}
                    example: []
