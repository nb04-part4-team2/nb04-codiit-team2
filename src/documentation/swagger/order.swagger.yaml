# ========================================
# Order API Swagger Documentation
# ========================================
# 작성일: 2025-01-05
# 도메인: Order - 주문 관리
# 총 5개 엔드포인트
#
# 엔드포인트:
# - GET    /api/orders - 주문 목록 조회
# - POST   /api/orders - 주문 생성
# - GET    /api/orders/:orderId - 주문 상세 조회
# - PATCH  /api/orders/:orderId - 주문 배송 정보 수정
# - DELETE /api/orders/:orderId - 주문 취소
#
# 특징:
# - BUYER 전용 (구매자만 접근 가능)
# - 주문 상태별 필터링 (결제대기, 결제완료, 취소, 배송완료)
# - 포인트 사용 및 적립
# - 재고 관리 자동 처리
# - 주문 취소 시 재고 복구 및 포인트 환불
# ========================================

paths:
  /api/orders:
    get:
      tags:
        - Order
      summary: 주문 목록 조회
      description: |
        로그인한 구매자의 주문 목록을 조회합니다.

        인증 필요:
        `Bearer 토큰 필수`

        권한:
        `BUYER` 전용

        필터링:
        주문 상태별로 필터링 가능 (WaitingPayment, CompletedPayment, Cancelled, Delivered)

        페이지네이션:
        `page`: 페이지 번호 (기본값: 1)
        `limit`: 페이지당 항목 수 (기본값: 3, 최대: `100`)

        응답 구조:
        `data`: 주문 목록 배열
        `meta`: 페이지네이션 정보 (total, page, limit, totalPages)
      security:
        - bearerAuth: []
      parameters:
        - name: status
          in: query
          required: true
          schema:
            type: string
            enum:
              - WaitingPayment
              - CompletedPayment
              - Cancelled
              - Delivered
          description: |
            주문 상태 필터
            WaitingPayment: 결제 대기
            CompletedPayment: 결제 완료
            Cancelled: 주문 취소
            Delivered: 배송 완료
          example: 'CompletedPayment'
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 3
          description: '페이지당 항목 수'
          example: 10
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
          description: '페이지 번호'
          example: 1
      responses:
        '200':
          description: 주문 목록 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    description: '주문 목록'
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          description: '주문 고유 ID'
                          example: 'cm7order123abc456def789'
                        name:
                          type: string
                          description: '수령인 이름'
                          example: '김구매자'
                        phoneNumber:
                          type: string
                          description: '수령인 연락처'
                          example: '010-1234-5678'
                        address:
                          type: string
                          description: '배송지 주소'
                          example: '서울시 강남구 테헤란로 123'
                        subtotal:
                          type: integer
                          description: '총 주문 금액 (포인트 차감 전)'
                          example: 150000
                        totalQuantity:
                          type: integer
                          description: '총 주문 수량'
                          example: 3
                        usePoint:
                          type: integer
                          description: '사용한 포인트'
                          example: 0 # 기본 유저는 포인트 없어서 0으로 설정
                        createdAt:
                          type: string
                          format: date-time
                          example: '2025-01-05T10:30:00.000Z'
                        orderItems:
                          type: array
                          description: '주문 상품 목록'
                          items:
                            type: object
                            properties:
                              id:
                                type: string
                                example: 'cm7item456xyz789abc012'
                              price:
                                type: integer
                                description: '상품 단가 (할인 적용 후)'
                                example: 71200
                              quantity:
                                type: integer
                                example: 2
                              productId:
                                type: string
                                example: 'cm4abc123def456ghi789jkl'
                              product:
                                type: object
                                properties:
                                  name:
                                    type: string
                                    example: '코디잇 오버핏 후드티'
                                  image:
                                    type: string
                                    example: 'https://codiit-images.s3.ap-northeast-2.amazonaws.com/product-hoodie-main.jpg'
                                  reviews:
                                    type: array
                                    description: '해당 주문 아이템에 대한 리뷰 (작성한 경우)'
                                    items:
                                      type: object
                                      properties:
                                        id:
                                          type: string
                                          example: 'cm7review123abc456def'
                                        rating:
                                          type: integer
                                          description: '별점 (`1`-`5`)'
                                          example: 5
                                        content:
                                          type: string
                                          example: '정말 만족스러운 상품입니다!'
                                        createdAt:
                                          type: string
                                          format: date-time
                                          example: '2025-01-07T14:20:00.000Z'
                              size:
                                type: object
                                properties:
                                  id:
                                    type: integer
                                    description: '사이즈 ID (`1`:XS, `2`:S, `3`:M, `4`:L, `5`:XL, `6`:FREE)'
                                    example: 3
                                  size:
                                    type: object
                                    properties:
                                      en:
                                        type: string
                                        example: 'M'
                                      ko:
                                        type: string
                                        example: 'M'
                              isReviewed:
                                type: boolean
                                description: '리뷰 작성 여부'
                                example: true
                        payments:
                          type: object
                          description: '결제 정보'
                          properties:
                            id:
                              type: string
                              example: 'cm7payment789xyz012abc'
                            orderId:
                              type: string
                              example: 'cm7order123abc456def789'
                            price:
                              type: integer
                              description: '최종 결제 금액 (포인트 차감 후)'
                              example: 145000
                            status:
                              type: string
                              enum:
                                - Pending
                                - CompletedPayment
                                - Failed
                                - Cancelled
                              description: |
                                결제 상태
                                `Pending`: 결제 대기
                                `CompletedPayment`: 결제 완료
                                `Failed`: 결제 실패
                                `Cancelled`: 결제 취소
                              example: 'CompletedPayment'
                            createdAt:
                              type: string
                              format: date-time
                              example: '2025-01-05T10:30:00.000Z'
                            updatedAt:
                              type: string
                              format: date-time
                              example: '2025-01-05T10:30:00.000Z'
                  meta:
                    type: object
                    description: '페이지네이션 정보'
                    properties:
                      total:
                        type: integer
                        description: '전체 주문 수'
                        example: 42
                      page:
                        type: integer
                        example: 1
                      limit:
                        type: integer
                        example: 10
                      totalPages:
                        type: integer
                        description: '전체 페이지 수'
                        example: 5
        '400':
          description: 유효성 검증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalidStatus:
                  value:
                    message: '유효성 검증에 실패했습니다.'
                    details:
                      - field: 'status'
                        message: '올바른 주문 상태를 입력해주세요.'
                invalidLimit:
                  value:
                    message: '유효성 검증에 실패했습니다.'
                    details:
                      - field: 'limit'
                        message: 'limit는 `1`~`100` 사이의 값이어야 합니다.'
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: '인증이 필요합니다.'
                details: []
        '403':
          description: 권한 없음 (판매자 접근 시도)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: '구매자만 접근할 수 있습니다.'
                details: []

    post:
      tags:
        - Order
      summary: 주문 생성
      description: |
        새로운 주문을 생성합니다.

        인증 필요:
        `Bearer 토큰 필수`

        권한:
        `BUYER` 전용

        주문 프로세스:
        배송 정보 입력 (이름, 연락처, 주소)
        포인트 사용 여부 선택
        주문 상품 목록 제공
        재고 차감 및 결제 정보 생성
        판매자에게 주문 알림 발송
        구매자 포인트 적립

        주의사항:
        비회원 주문 불가 (로그인 필수)
        최소 `1개` 이상의 상품 필요
        포인트는 보유 포인트 범위 내에서만 사용 가능
        재고 부족 시 주문 실패
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - phone
                - address
                - usePoint
                - orderItems
              properties:
                name:
                  type: string
                  minLength: 1
                  description: '수령인 이름'
                  example: '김구매자'
                phone:
                  type: string
                  maxLength: 13
                  description: '수령인 연락처'
                  example: '010-1234-5678'
                address:
                  type: string
                  minLength: 1
                  description: '배송지 주소'
                  example: '서울시 강남구 테헤란로 123'
                usePoint:
                  type: integer
                  minimum: 0
                  description: '사용할 포인트 (0 이상)'
                  example: 5000
                orderItems:
                  type: array
                  minItems: 1
                  description: '주문 상품 목록 (최소 1개)'
                  items:
                    type: object
                    required:
                      - productId
                      - sizeId
                      - quantity
                    properties:
                      productId:
                        type: string
                        description: '상품 고유 ID'
                        example: 'cm4abc123def456ghi789jkl'
                      sizeId:
                        type: integer
                        minimum: 1
                        maximum: 6
                        description: '사이즈 ID (1:XS, 2:S, 3:M, 4:L, 5:XL, 6:FREE)'
                        example: 3
                      quantity:
                        type: integer
                        minimum: 1
                        description: '주문 수량'
                        example: 2
                  example:
                    - productId: 'cm4abc123def456ghi789jkl'
                      sizeId: 3
                      quantity: 2
                    - productId: 'cm4xyz789abc012def345ghi'
                      sizeId: 2
                      quantity: 1
      responses:
        '201':
          description: 주문 생성 성공
          content:
            application/json:
              schema:
                type: object
                description: 'GET /api/orders/:orderId 응답과 동일한 구조'
                properties:
                  id:
                    type: string
                    example: 'cm7order123abc456def789'
                  name:
                    type: string
                    example: '김구매자'
                  phoneNumber:
                    type: string
                    example: '010-1234-5678'
                  address:
                    type: string
                    example: '서울시 강남구 테헤란로 123'
                  subtotal:
                    type: integer
                    example: 150000
                  totalQuantity:
                    type: integer
                    example: 3
                  usePoint:
                    type: integer
                    example: 5000
                  createdAt:
                    type: string
                    format: date-time
                    example: '2025-01-05T10:30:00.000Z'
                  orderItems:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          example: 'cm7item456xyz789abc012'
                        price:
                          type: integer
                          example: 71200
                        quantity:
                          type: integer
                          example: 2
                        productId:
                          type: string
                          example: 'cm4abc123def456ghi789jkl'
                        product:
                          type: object
                          properties:
                            name:
                              type: string
                              example: '코디잇 오버핏 후드티'
                            image:
                              type: string
                              example: 'https://codiit-images.s3.ap-northeast-2.amazonaws.com/product-hoodie-main.jpg'
                            reviews:
                              type: array
                              description: '신규 주문이므로 빈 배열'
                              items: {}
                              example: []
                        size:
                          type: object
                          properties:
                            id:
                              type: integer
                              example: 3
                            size:
                              type: object
                              properties:
                                en:
                                  type: string
                                  example: 'M'
                                ko:
                                  type: string
                                  example: 'M'
                        isReviewed:
                          type: boolean
                          description: '신규 주문이므로 false'
                          example: false
                  payments:
                    type: object
                    properties:
                      id:
                        type: string
                        example: 'cm7payment789xyz012abc'
                      orderId:
                        type: string
                        example: 'cm7order123abc456def789'
                      price:
                        type: integer
                        description: '최종 결제 금액 (subtotal - usePoint)'
                        example: 145000
                      status:
                        type: string
                        example: 'Pending'
                      createdAt:
                        type: string
                        format: date-time
                        example: '2025-01-05T10:30:00.000Z'
                      updatedAt:
                        type: string
                        format: date-time
                        example: '2025-01-05T10:30:00.000Z'
        '400':
          description: 유효성 검증 실패 또는 재고 부족
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                noItems:
                  value:
                    message: '유효성 검증에 실패했습니다.'
                    details:
                      - field: 'orderItems'
                        message: '최소 한 개 이상의 상품이 있어야 합니다.'
                insufficientStock:
                  value:
                    message: '재고가 부족합니다.'
                    details: []
                insufficientPoint:
                  value:
                    message: '포인트가 부족합니다.'
                    details: []
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: '인증이 필요합니다.'
                details: []
        '403':
          description: 권한 없음 (판매자 접근 시도)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: '구매자만 접근할 수 있습니다.'
                details: []
        '404':
          description: 상품을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: '상품을 찾을 수 없습니다.'
                details: []

  /api/orders/{orderId}:
    get:
      tags:
        - Order
      summary: 주문 상세 조회
      description: |
        특정 주문의 상세 정보를 조회합니다.

        인증 필요:
        `Bearer 토큰 필수`

        권한:
        `BUYER` 전용

        포함 정보:
        배송 정보 (이름, 연락처, 주소)
        주문 금액 정보 (`subtotal`, `usePoint`)
        주문 상품 목록 (상품 정보, 사이즈, 수량)
        리뷰 작성 여부
        결제 정보 (금액, 상태)
      security:
        - bearerAuth: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
          description: '주문 고유 ID'
          example: 'cm7order123abc456def789'
      responses:
        '200':
          description: 주문 상세 조회 성공
          content:
            application/json:
              schema:
                type: object
                description: 'POST /api/orders 응답과 동일한 구조'
                properties:
                  id:
                    type: string
                    example: 'cm7order123abc456def789'
                  name:
                    type: string
                    example: '김구매자'
                  phoneNumber:
                    type: string
                    example: '010-1234-5678'
                  address:
                    type: string
                    example: '서울시 강남구 테헤란로 123'
                  subtotal:
                    type: integer
                    example: 150000
                  totalQuantity:
                    type: integer
                    example: 3
                  usePoint:
                    type: integer
                    example: 5000
                  createdAt:
                    type: string
                    format: date-time
                    example: '2025-01-05T10:30:00.000Z'
                  orderItems:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          example: 'cm7item456xyz789abc012'
                        price:
                          type: integer
                          example: 71200
                        quantity:
                          type: integer
                          example: 2
                        productId:
                          type: string
                          example: 'cm4abc123def456ghi789jkl'
                        product:
                          type: object
                          properties:
                            name:
                              type: string
                              example: '코디잇 오버핏 후드티'
                            image:
                              type: string
                              example: 'https://codiit-images.s3.ap-northeast-2.amazonaws.com/product-hoodie-main.jpg'
                            reviews:
                              type: array
                              description: '신규 주문이므로 빈 배열'
                              items: {}
                              example: []
                        size:
                          type: object
                          properties:
                            id:
                              type: integer
                              example: 3
                            size:
                              type: object
                              properties:
                                en:
                                  type: string
                                  example: 'M'
                                ko:
                                  type: string
                                  example: 'M'
                        isReviewed:
                          type: boolean
                          description: '신규 주문이므로 false'
                          example: false
                  payments:
                    type: object
                    properties:
                      id:
                        type: string
                        example: 'cm7payment789xyz012abc'
                      orderId:
                        type: string
                        example: 'cm7order123abc456def789'
                      price:
                        type: integer
                        description: '최종 결제 금액 (subtotal - usePoint)'
                        example: 145000
                      status:
                        type: string
                        example: 'Pending'
                      createdAt:
                        type: string
                        format: date-time
                        example: '2025-01-05T10:30:00.000Z'
                      updatedAt:
                        type: string
                        format: date-time
                        example: '2025-01-05T10:30:00.000Z'
        '400':
          description: 유효성 검증 실패 (잘못된 ID 형식)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: '유효성 검증에 실패했습니다.'
                details:
                  - field: 'orderId'
                    message: '유효한 주문 ID를 입력하세요.'
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: '인증이 필요합니다.'
                details: []
        '403':
          description: 권한 없음 (본인의 주문이 아님 또는 판매자)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                notBuyer:
                  value:
                    message: '구매자만 접근할 수 있습니다.'
                    details: []
                notOwner:
                  value:
                    message: '본인의 주문만 조회할 수 있습니다.'
                    details: []
        '404':
          description: 주문을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: '주문을 찾을 수 없습니다.'
                details: []

    patch:
      tags:
        - Order
      summary: 주문 배송 정보 수정
      description: |
        주문의 배송 정보를 수정합니다.

        인증 필요:
        `Bearer 토큰 필수`

        권한:
        `BUYER` 전용

        수정 가능 항목:
        수령인 이름
        수령인 연락처
        배송지 주소

        주의사항:
        본인의 주문만 수정 가능
        결제 완료 전 또는 배송 전에만 수정 권장
      security:
        - bearerAuth: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
          description: '주문 고유 ID'
          example: 'cm7order123abc456def789'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - phone
                - address
              properties:
                name:
                  type: string
                  minLength: 1
                  description: '수령인 이름'
                  example: '김수정'
                phone:
                  type: string
                  maxLength: 13
                  description: '수령인 연락처'
                  example: '010-9876-5432'
                address:
                  type: string
                  minLength: 1
                  description: '배송지 주소'
                  example: '서울시 송파구 올림픽로 300'
      responses:
        '200':
          description: 주문 수정 성공
          content:
            application/json:
              schema:
                type: object
                description: 'GET /api/orders/:orderId 응답과 동일한 구조 (수정된 정보 반영)'
                properties:
                  id:
                    type: string
                    example: 'cm7order123abc456def789'
                  name:
                    type: string
                    example: '김구매자'
                  phoneNumber:
                    type: string
                    example: '010-1234-5678'
                  address:
                    type: string
                    example: '서울시 강남구 테헤란로 123'
                  subtotal:
                    type: integer
                    example: 150000
                  totalQuantity:
                    type: integer
                    example: 3
                  usePoint:
                    type: integer
                    example: 5000
                  createdAt:
                    type: string
                    format: date-time
                    example: '2025-01-05T10:30:00.000Z'
                  orderItems:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          example: 'cm7item456xyz789abc012'
                        price:
                          type: integer
                          example: 71200
                        quantity:
                          type: integer
                          example: 2
                        productId:
                          type: string
                          example: 'cm4abc123def456ghi789jkl'
                        product:
                          type: object
                          properties:
                            name:
                              type: string
                              example: '코디잇 오버핏 후드티'
                            image:
                              type: string
                              example: 'https://codiit-images.s3.ap-northeast-2.amazonaws.com/product-hoodie-main.jpg'
                            reviews:
                              type: array
                              description: '신규 주문이므로 빈 배열'
                              items: {}
                              example: []
                        size:
                          type: object
                          properties:
                            id:
                              type: integer
                              example: 3
                            size:
                              type: object
                              properties:
                                en:
                                  type: string
                                  example: 'M'
                                ko:
                                  type: string
                                  example: 'M'
                        isReviewed:
                          type: boolean
                          description: '신규 주문이므로 false'
                          example: false
                  payments:
                    type: object
                    properties:
                      id:
                        type: string
                        example: 'cm7payment789xyz012abc'
                      orderId:
                        type: string
                        example: 'cm7order123abc456def789'
                      price:
                        type: integer
                        description: '최종 결제 금액 (subtotal - usePoint)'
                        example: 145000
                      status:
                        type: string
                        example: 'Pending'
                      createdAt:
                        type: string
                        format: date-time
                        example: '2025-01-05T10:30:00.000Z'
                      updatedAt:
                        type: string
                        format: date-time
                        example: '2025-01-05T10:30:00.000Z'
        '400':
          description: 유효성 검증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalidOrderId:
                  value:
                    message: '유효성 검증에 실패했습니다.'
                    details:
                      - field: 'orderId'
                        message: '유효한 주문 ID를 입력하세요.'
                emptyName:
                  value:
                    message: '유효성 검증에 실패했습니다.'
                    details:
                      - field: 'name'
                        message: '이름을 입력해야 합니다.'
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: '인증이 필요합니다.'
                details: []
        '403':
          description: 권한 없음 (본인의 주문이 아님 또는 판매자)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                notBuyer:
                  value:
                    message: '구매자만 접근할 수 있습니다.'
                    details: []
                notOwner:
                  value:
                    message: '본인의 주문만 수정할 수 있습니다.'
                    details: []
        '404':
          description: 주문을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: '주문을 찾을 수 없습니다.'
                details: []

    delete:
      tags:
        - Order
      summary: 주문 취소
      description: |
        주문을 취소합니다.

        인증 필요:
        `Bearer 토큰 필수`

        권한:
        `BUYER` 전용

        취소 프로세스:
        1. 주문 상태를 Cancelled로 변경
        2. 결제 취소 처리
        3. 재고 복구
        4. 사용한 포인트 복구
        5. 적립된 포인트 회수

        주의사항:
        본인의 주문만 취소 가능
        취소된 주문은 복구할 수 없음
      security:
        - bearerAuth: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
          description: '주문 고유 ID'
          example: 'cm7order123abc456def789'
      responses:
        '200':
          description: 주문 취소 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: '주문이 성공적으로 취소되고 포인트가 복구되었습니다.'
        '400':
          description: 유효성 검증 실패 (잘못된 ID 형식)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: '유효성 검증에 실패했습니다.'
                details:
                  - field: 'orderId'
                    message: '유효한 주문 ID를 입력하세요.'
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: '인증이 필요합니다.'
                details: []
        '403':
          description: 권한 없음 (본인의 주문이 아님 또는 판매자)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                notBuyer:
                  value:
                    message: '구매자만 접근할 수 있습니다.'
                    details: []
                notOwner:
                  value:
                    message: '본인의 주문만 취소할 수 있습니다.'
                    details: []
        '404':
          description: 주문을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: '주문을 찾을 수 없습니다.'
                details: []
