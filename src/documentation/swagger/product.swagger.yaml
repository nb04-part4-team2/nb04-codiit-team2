# ========================================
# Product API Swagger Documentation
# ========================================
# 작성일: 2025-01-05
# 도메인: Product - 상품 관리
# 총 5개 엔드포인트
#
# 엔드포인트:
# - POST   /api/products - 상품 등록 (SELLER)
# - GET    /api/products - 상품 목록 조회 (공개)
# - GET    /api/products/:productId - 상품 상세 조회 (공개)
# - PATCH  /api/products/:productId - 상품 수정 (SELLER)
# - DELETE /api/products/:productId - 상품 삭제 (SELLER)
# ========================================

paths:
  /api/products:
    post:
      tags:
        - Product
      summary: 상품 등록
      description: |
        판매자가 자신의 스토어에 새로운 상품을 등록합니다.

        인증 필요: `Bearer 토큰 필수`
        권한: `SELLER` 전용
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - categoryName
                - price
                - content
                - image
                - stocks
              properties:
                name:
                  type: string
                  maxLength: 100
                  example: '코디잇 오버핏 후드티'
                categoryName:
                  type: string
                  example: 'OUTER'
                price:
                  type: integer
                  minimum: 0
                  example: 89000
                content:
                  type: string
                  minLength: 10
                  example: '겨울철 필수 아이템! 따뜻하고 편안한 오버핏 후드티입니다.'
                image:
                  type: string
                  format: uri
                  example: 'https://codiit-images.s3.ap-northeast-2.amazonaws.com/product-hoodie-main.jpg'
                stocks:
                  type: array
                  minItems: 1
                  description: '사이즈별 재고 정보'
                  items:
                    type: object
                    required:
                      - sizeId
                      - quantity
                    properties:
                      sizeId:
                        type: integer
                        description: '사이즈 ID (1:XS, 2:S, 3:M, 4:L, 5:XL, 6:FREE)'
                        example: 3
                      quantity:
                        type: integer
                        minimum: 0
                        example: 50
                discountRate:
                  type: integer
                  nullable: true
                  example: 20
                discountStartTime:
                  type: string
                  format: date-time
                  nullable: true
                discountEndTime:
                  type: string
                  format: date-time
                  nullable: true
      responses:
        '201':
          description: 상품 등록 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductDetailResponse'
        '400':
          description: 유효성 검증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: 스토어 또는 카테고리를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    get:
      tags:
        - Product
      summary: 상품 목록 조회
      description: |
        상품 목록을 조회합니다.

        인증 불필요: Public API
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: pageSize
          in: query
          schema:
            type: integer
            default: 10
        - name: search
          in: query
          schema:
            type: string
          description: '검색 키워드'
        - name: sort
          in: query
          schema:
            type: string
            enum: [mostReviewed, recent, lowPrice, highPrice, highRating, salesRanking]
            default: recent
        - name: favoriteStore
          in: query
          schema:
            type: string
          description: '관심 스토어 ID'
        - name: categoryName
          in: query
          schema:
            type: string
        - name: priceMin
          in: query
          schema:
            type: integer
        - name: priceMax
          in: query
          schema:
            type: integer
        - name: size
          in: query
          schema:
            type: string
      responses:
        '200':
          description: 상품 목록 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  totalCount:
                    type: integer
                    example: 42
                  list:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          example: 'cm4abc123def456ghi789jkl'
                        storeId:
                          type: string
                          example: 'cmjtkn0td0017p701tp5nwslg'
                        storeName:
                          type: string
                          example: '코디잇 패션스토어'
                        name:
                          type: string
                          example: '코디잇 오버핏 후드티'
                        image:
                          type: string
                          example: 'https://codiit-images.s3.ap-northeast-2.amazonaws.com/product-hoodie-main.jpg'
                        price:
                          type: integer
                          example: 89000
                        discountPrice:
                          type: integer
                          example: 71200
                        discountRate:
                          type: integer
                          nullable: true
                          example: 20
                        discountStartTime:
                          type: string
                          format: date-time
                          nullable: true
                        discountEndTime:
                          type: string
                          format: date-time
                          nullable: true
                        reviewsCount:
                          type: integer
                          example: 127
                        reviewsRating:
                          type: number
                          example: 4.5
                        sales:
                          type: integer
                          description: '판매량'
                          example: 342
                        isSoldOut:
                          type: boolean
                          description: '품절 여부'
                          example: false
                        createdAt:
                          type: string
                          format: date-time
                        updatedAt:
                          type: string
                          format: date-time
        '400':
          description: 유효성 검증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/products/{productId}:
    get:
      tags:
        - Product
      summary: 상품 상세 조회
      description: |
        특정 상품의 상세 정보를 조회합니다.
      parameters:
        - name: productId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 상품 상세 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductDetailResponse'
        '404':
          description: 상품을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    patch:
      tags:
        - Product
      summary: 상품 수정
      description: |
        판매자가 자신의 상품 정보를 수정합니다.
        `stocks` 전송 시 기존 재고는 삭제되고 대체됩니다.
      security:
        - bearerAuth: []
      parameters:
        - name: productId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name: { type: string }
                categoryName: { type: string }
                price: { type: integer }
                content: { type: string }
                image: { type: string }
                stocks:
                  type: array
                  items:
                    type: object
                    required: [sizeId, quantity]
                    properties:
                      sizeId: { type: integer }
                      quantity: { type: integer }
                discountRate: { type: integer, nullable: true }
                discountStartTime: { type: string, format: date-time, nullable: true }
                discountEndTime: { type: string, format: date-time, nullable: true }
                isSoldOut: { type: boolean }
      responses:
        '200':
          description: 상품 수정 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductDetailResponse'
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: 권한 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: 상품 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - Product
      summary: 상품 삭제
      security:
        - bearerAuth: []
      parameters:
        - name: productId
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: 상품 삭제 성공
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: 권한 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: 상품 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    # 카테고리 응답 객체 (Mapper와 일치: id, name만 존재)
    CategoryResponse:
      type: object
      properties:
        id:
          type: string
        name:
          type: string

    # 리뷰 통계 객체
    ReviewStats:
      type: object
      properties:
        rate1Length: { type: integer }
        rate2Length: { type: integer }
        rate3Length: { type: integer }
        rate4Length: { type: integer }
        rate5Length: { type: integer }
        sumScore: { type: integer }

    # 재고 정보 객체
    StockResponse:
      type: object
      properties:
        id: { type: string }
        productId: { type: string }
        quantity: { type: integer }
        size:
          type: object
          properties:
            id: { type: integer }
            name: { type: string }

    # 상품 상세 응답 (DetailMapper 기준: sales, isSoldOut 제거됨)
    ProductDetailResponse:
      type: object
      properties:
        id: { type: string }
        storeId: { type: string }
        storeName: { type: string }
        name: { type: string }
        content: { type: string }
        image: { type: string }
        price: { type: integer }
        discountPrice: { type: integer }
        discountRate: { type: integer, nullable: true }
        discountStartTime: { type: string, format: date-time, nullable: true }
        discountEndTime: { type: string, format: date-time, nullable: true }
        reviewsCount: { type: integer }
        reviewsRating: { type: number }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
        # 관계형 데이터
        category:
          type: array
          items:
            $ref: '#/components/schemas/CategoryResponse'
        stocks:
          type: array
          items:
            $ref: '#/components/schemas/StockResponse'
        reviews:
          $ref: '#/components/schemas/ReviewStats'
        inquiries:
          type: array
          description: '해당 상품의 전체 문의 내역 (최신순)'
          items:
            type: object
            properties:
              id: { type: string }
              title: { type: string }
              content: { type: string }
              status: { type: string }
              isSecret: { type: boolean }
              createdAt: { type: string, format: date-time }
              updatedAt: { type: string, format: date-time }
              reply:
                type: object
                nullable: true
                properties:
                  id: { type: string }
                  content: { type: string }
                  createdAt: { type: string, format: date-time }
                  updatedAt: { type: string, format: date-time }
                  user:
                    type: object
                    properties:
                      id: { type: string }
                      name: { type: string }
