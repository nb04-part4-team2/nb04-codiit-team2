# ========================================
# Product API Swagger Documentation
# ========================================
# 작성일: 2025-01-05
# 도메인: Product - 상품 관리
# 총 5개 엔드포인트
#
# 엔드포인트:
# - POST   /api/products - 상품 등록 (SELLER)
# - GET    /api/products - 상품 목록 조회 (공개)
# - GET    /api/products/:productId - 상품 상세 조회 (공개)
# - PATCH  /api/products/:productId - 상품 수정 (SELLER)
# - DELETE /api/products/:productId - 상품 삭제 (SELLER)
#
# 특징:
# - 판매자 전용 (등록/수정/삭제)
# - 공개 API (목록/상세 조회)
# - 사이즈별 재고 관리
# - 할인율 및 할인 기간 설정
# - 필터링 및 정렬 지원 (가격순, 리뷰순, 판매순 등)
# ========================================

paths:
  /api/products:
    post:
      tags:
        - Product
      summary: 상품 등록
      description: |
        판매자가 자신의 스토어에 새로운 상품을 등록합니다.

        인증 필요:
        `Bearer 토큰 필수`

        권한:
        `SELLER` 전용

        주의사항:
        `stocks` 배열에는 최소 1개 이상의 재고 옵션이 필요합니다.
        할인 적용 시 할인 시작 시간이 종료 시간보다 빨라야 합니다.
        할인율은 `0`~`100` 사이의 정수여야 합니다.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - storeId
                - categoryId
                - price
                - content
                - image
                - stocks
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                  description: "상품명"
                  example: "코디잇 오버핏 후드티"
                storeId:
                  type: string
                  description: "스토어 고유 ID"
                  example: "cmjtkn0td0017p701tp5nwslg"
                categoryId:
                  type: string
                  description: "카테고리 고유 ID"
                  example: "category_fashion_outer"
                price:
                  type: integer
                  minimum: 0
                  description: "정가 (원)"
                  example: 89000
                content:
                  type: string
                  minLength: 10
                  description: "상품 상세 설명 (최소 10자)"
                  example: "겨울철 필수 아이템! 따뜻하고 편안한 오버핏 후드티입니다. 고급 원단으로 제작되어 세탁 후에도 형태가 유지됩니다."
                image:
                  type: string
                  format: uri
                  description: "대표 이미지 URL"
                  example: "https://codiit-images.s3.ap-northeast-2.amazonaws.com/product-hoodie-main.jpg"
                stocks:
                  type: array
                  minItems: 1
                  description: "사이즈별 재고 정보"
                  items:
                    type: object
                    required:
                      - sizeId
                      - quantity
                    properties:
                      sizeId:
                        type: integer
                        minimum: 1
                        maximum: 6
                        description: "사이즈 ID (1:XS, 2:S, 3:M, 4:L, 5:XL, 6:FREE)"
                        example: 3
                      quantity:
                        type: integer
                        minimum: 0
                        description: "재고 수량"
                        example: 50
                  example:
                    - sizeId: 2
                      quantity: 30
                    - sizeId: 3
                      quantity: 50
                    - sizeId: 4
                      quantity: 40
                discountRate:
                  type: integer
                  minimum: 0
                  maximum: 100
                  nullable: true
                  description: "할인율 (0~100, 선택사항)"
                  example: 20
                discountStartTime:
                  type: string
                  format: date-time
                  nullable: true
                  description: "할인 시작 시간 (선택사항)"
                  example: "2025-01-01T00:00:00.000Z"
                discountEndTime:
                  type: string
                  format: date-time
                  nullable: true
                  description: "할인 종료 시간 (선택사항)"
                  example: "2025-01-31T23:59:59.999Z"
      responses:
        '201':
          description: 상품 등록 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    description: "상품 고유 ID"
                    example: "cm4abc123def456ghi789jkl"
                  storeId:
                    type: string
                    example: "cmjtkn0td0017p701tp5nwslg"
                  categoryId:
                    type: string
                    example: "category_fashion_outer"
                  name:
                    type: string
                    example: "코디잇 오버핏 후드티"
                  price:
                    type: integer
                    example: 89000
                  content:
                    type: string
                    example: "겨울철 필수 아이템! 따뜻하고 편안한 오버핏 후드티입니다."
                  image:
                    type: string
                    example: "https://codiit-images.s3.ap-northeast-2.amazonaws.com/product-hoodie-main.jpg"
                  discountRate:
                    type: integer
                    nullable: true
                    example: 20
                  discountStartTime:
                    type: string
                    format: date-time
                    nullable: true
                    example: "2025-01-01T00:00:00.000Z"
                  discountEndTime:
                    type: string
                    format: date-time
                    nullable: true
                    example: "2025-01-31T23:59:59.999Z"
                  createdAt:
                    type: string
                    format: date-time
                    example: "2025-01-05T08:30:00.000Z"
                  updatedAt:
                    type: string
                    format: date-time
                    example: "2025-01-05T08:30:00.000Z"
        '400':
          description: 유효성 검증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalidStocks:
                  value:
                    message: "유효성 검증에 실패했습니다."
                    details:
                      - field: "stocks"
                        message: "최소 1개 이상의 재고 옵션이 필요합니다."
                invalidDiscountTime:
                  value:
                    message: "유효성 검증에 실패했습니다."
                    details:
                      - field: "discountStartTime"
                        message: "할인 시작 시간이 종료 시간보다 빨라야 합니다."
                invalidDiscountRate:
                  value:
                    message: "유효성 검증에 실패했습니다."
                    details:
                      - field: "discountRate"
                        message: "할인율은 0~100 사이의 정수여야 합니다."
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: "로그인이 필요합니다."
                details: []
        '403':
          description: 권한 없음 (구매자 접근 시도)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: "판매자만 접근할 수 있습니다."
                details: []
        '404':
          description: 스토어 또는 카테고리를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                storeNotFound:
                  value:
                    message: "스토어를 찾을 수 없습니다."
                    details: []
                categoryNotFound:
                  value:
                    message: "카테고리를 찾을 수 없습니다."
                    details: []

    get:
      tags:
        - Product
      summary: 상품 목록 조회
      description: |
        상품 목록을 조회합니다. 필터링, 검색, 정렬, 페이지네이션을 지원합니다.

        인증 불필요:
        Public API (누구나 접근 가능)

        정렬 옵션:
        `mostReviewed` - 리뷰 많은순
        `recent` - 최신순 (기본값)
        `lowPrice` - 낮은 가격순
        `highPrice` - 높은 가격순
        `highRating` - 별점 높은순
        `salesRanking` - 판매순
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
          description: "페이지 번호"
          example: 1
        - name: pageSize
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
          description: "페이지당 항목 수"
          example: 20
        - name: keyword
          in: query
          schema:
            type: string
          description: "검색 키워드 (상품명)"
          example: "후드티"
        - name: sort
          in: query
          schema:
            type: string
            enum:
              - mostReviewed
              - recent
              - lowPrice
              - highPrice
              - highRating
              - salesRanking
            default: recent
          description: "정렬 기준"
          example: "highRating"
        - name: brandId
          in: query
          schema:
            type: string
          description: "브랜드 ID 필터"
          example: "brand_fashion_nike"
        - name: categoryId
          in: query
          schema:
            type: string
          description: "카테고리 ID 필터"
          example: "category_fashion_outer"
        - name: minPrice
          in: query
          schema:
            type: integer
            minimum: 0
          description: "최소 가격"
          example: 50000
        - name: maxPrice
          in: query
          schema:
            type: integer
            minimum: 0
          description: "최대 가격"
          example: 100000
      responses:
        '200':
          description: 상품 목록 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  totalCount:
                    type: integer
                    description: "전체 상품 수"
                    example: 42
                  page:
                    type: integer
                    example: 1
                  pageSize:
                    type: integer
                    example: 20
                  items:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          description: "상품 고유 ID"
                          example: "cm4abc123def456ghi789jkl"
                        storeId:
                          type: string
                          example: "cmjtkn0td0017p701tp5nwslg"
                        storeName:
                          type: string
                          example: "코디잇 패션스토어"
                        categoryId:
                          type: string
                          example: "category_fashion_outer"
                        name:
                          type: string
                          example: "코디잇 오버핏 후드티"
                        price:
                          type: integer
                          description: "정가"
                          example: 89000
                        discountPrice:
                          type: integer
                          description: "할인 적용 후 실제 판매가"
                          example: 71200
                        discountRate:
                          type: integer
                          nullable: true
                          description: "할인율 (%)"
                          example: 20
                        image:
                          type: string
                          example: "https://codiit-images.s3.ap-northeast-2.amazonaws.com/product-hoodie-main.jpg"
                        reviewsCount:
                          type: integer
                          description: "리뷰 수"
                          example: 127
                        reviewsRating:
                          type: number
                          description: "평균 별점"
                          example: 4.5
                        sales:
                          type: integer
                          description: "판매량"
                          example: 342
                        isSoldOut:
                          type: boolean
                          description: "품절 여부"
                          example: false
                        createdAt:
                          type: string
                          format: date-time
                          example: "2025-01-05T08:30:00.000Z"
                        updatedAt:
                          type: string
                          format: date-time
                          example: "2025-01-05T08:30:00.000Z"
        '400':
          description: 유효성 검증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: "유효성 검증에 실패했습니다."
                details:
                  - field: "page"
                    message: "페이지 번호는 1 이상이어야 합니다."

  /api/products/{productId}:
    get:
      tags:
        - Product
      summary: 상품 상세 조회
      description: |
        특정 상품의 상세 정보를 조회합니다.

        인증 불필요:
        Public API (누구나 접근 가능)

        포함되는 정보:
        기본 상품 정보
        사이즈별 재고 현황
        카테고리 정보
        리뷰 통계 (별점 분포)
        상위 3개 문의/답변
      parameters:
        - name: productId
          in: path
          required: true
          schema:
            type: string
          description: "상품 고유 ID"
          example: "cm4abc123def456ghi789jkl"
      responses:
        '200':
          description: 상품 상세 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    description: "상품 고유 ID"
                    example: "cm4abc123def456ghi789jkl"
                  storeId:
                    type: string
                    example: "cmjtkn0td0017p701tp5nwslg"
                  storeName:
                    type: string
                    example: "코디잇 패션스토어"
                  categoryId:
                    type: string
                    example: "category_fashion_outer"
                  name:
                    type: string
                    example: "코디잇 오버핏 후드티"
                  price:
                    type: integer
                    example: 89000
                  discountPrice:
                    type: integer
                    description: "할인 적용 후 실제 판매가"
                    example: 71200
                  discountRate:
                    type: integer
                    nullable: true
                    example: 20
                  discountStartTime:
                    type: string
                    format: date-time
                    nullable: true
                    example: "2025-01-01T00:00:00.000Z"
                  discountEndTime:
                    type: string
                    format: date-time
                    nullable: true
                    example: "2025-01-31T23:59:59.999Z"
                  content:
                    type: string
                    example: "겨울철 필수 아이템! 따뜻하고 편안한 오버핏 후드티입니다. 고급 원단으로 제작되어 세탁 후에도 형태가 유지됩니다."
                  image:
                    type: string
                    example: "https://codiit-images.s3.ap-northeast-2.amazonaws.com/product-hoodie-main.jpg"
                  reviewsCount:
                    type: integer
                    example: 127
                  reviewsRating:
                    type: number
                    example: 4.5
                  sales:
                    type: integer
                    example: 342
                  isSoldOut:
                    type: boolean
                    example: false
                  createdAt:
                    type: string
                    format: date-time
                    example: "2025-01-05T08:30:00.000Z"
                  updatedAt:
                    type: string
                    format: date-time
                    example: "2025-01-05T08:30:00.000Z"
                  reviews:
                    type: object
                    description: "리뷰 통계 (별점 분포)"
                    properties:
                      rate1Length:
                        type: integer
                        description: "1점 리뷰 수"
                        example: 2
                      rate2Length:
                        type: integer
                        description: "2점 리뷰 수"
                        example: 5
                      rate3Length:
                        type: integer
                        description: "3점 리뷰 수"
                        example: 18
                      rate4Length:
                        type: integer
                        description: "4점 리뷰 수"
                        example: 45
                      rate5Length:
                        type: integer
                        description: "5점 리뷰 수"
                        example: 57
                      sumScore:
                        type: integer
                        description: "전체 별점 합계"
                        example: 571
                  inquiries:
                    type: array
                    description: "상위 3개 문의 (최신순)"
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          example: "cm5inquiry123abc456def"
                        userId:
                          type: string
                          example: "cm2xyz789abc012def345ghi"
                        userName:
                          type: string
                          example: "김구매자"
                        title:
                          type: string
                          example: "사이즈 문의드립니다"
                        content:
                          type: string
                          example: "평소 M 사이즈 입는데 오버핏이면 S 사이즈도 괜찮을까요?"
                        isSecret:
                          type: boolean
                          example: false
                        isAnswered:
                          type: boolean
                          example: true
                        createdAt:
                          type: string
                          format: date-time
                          example: "2025-01-04T10:20:00.000Z"
                        reply:
                          type: object
                          nullable: true
                          properties:
                            id:
                              type: string
                              example: "cm5reply456xyz789abc"
                            content:
                              type: string
                              example: "안녕하세요! 오버핏 제품이라 M 사이즈 추천드립니다."
                            createdAt:
                              type: string
                              format: date-time
                              example: "2025-01-04T14:30:00.000Z"
                  category:
                    type: array
                    description: "카테고리 계층 구조 (대분류 → 중분류 → 소분류)"
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          example: "category_fashion_outer"
                        name:
                          type: string
                          example: "아우터"
                        depth:
                          type: integer
                          description: "카테고리 깊이 (1:대분류, 2:중분류, 3:소분류)"
                          example: 2
                    example:
                      - id: "category_fashion"
                        name: "패션"
                        depth: 1
                      - id: "category_fashion_outer"
                        name: "아우터"
                        depth: 2
                  stocks:
                    type: array
                    description: "사이즈별 재고 현황"
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          description: "재고 고유 ID"
                          example: "cm5stock123abc456def"
                        productId:
                          type: string
                          example: "cm4abc123def456ghi789jkl"
                        quantity:
                          type: integer
                          description: "현재 재고 수량"
                          example: 45
                        size:
                          type: object
                          properties:
                            id:
                              type: integer
                              description: "사이즈 ID (1:XS, 2:S, 3:M, 4:L, 5:XL, 6:FREE)"
                              example: 3
                            name:
                              type: string
                              description: "사이즈 이름"
                              example: "M"
                    example:
                      - id: "cm5stock123abc456def"
                        productId: "cm4abc123def456ghi789jkl"
                        quantity: 28
                        size:
                          id: 2
                          name: "S"
                      - id: "cm5stock789xyz012abc"
                        productId: "cm4abc123def456ghi789jkl"
                        quantity: 45
                        size:
                          id: 3
                          name: "M"
                      - id: "cm5stock456def789ghi"
                        productId: "cm4abc123def456ghi789jkl"
                        quantity: 38
                        size:
                          id: 4
                          name: "L"
        '404':
          description: 상품을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: "상품을 찾을 수 없습니다."
                details: []

    patch:
      tags:
        - Product
      summary: 상품 수정
      description: |
        판매자가 자신의 상품 정보를 수정합니다.

        인증 필요:
        `Bearer 토큰 필수`

        권한:
        `SELLER` 전용

        주의사항:
        자신의 스토어 상품만 수정할 수 있습니다.
        모든 필드는 선택사항입니다 (수정할 항목만 전송).
        `stocks` 배열을 전송할 경우, 기존 재고는 모두 삭제되고 새로운 재고로 대체됩니다.
      security:
        - bearerAuth: []
      parameters:
        - name: productId
          in: path
          required: true
          schema:
            type: string
          description: "상품 고유 ID"
          example: "cm4abc123def456ghi789jkl"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                  example: "코디잇 프리미엄 오버핏 후드티"
                categoryId:
                  type: string
                  example: "category_fashion_outer"
                price:
                  type: integer
                  minimum: 0
                  example: 99000
                content:
                  type: string
                  minLength: 10
                  example: "겨울철 필수 아이템! 따뜻하고 편안한 프리미엄 오버핏 후드티입니다."
                image:
                  type: string
                  format: uri
                  example: "https://codiit-images.s3.ap-northeast-2.amazonaws.com/product-hoodie-updated.jpg"
                stocks:
                  type: array
                  minItems: 1
                  items:
                    type: object
                    required:
                      - sizeId
                      - quantity
                    properties:
                      sizeId:
                        type: integer
                        minimum: 1
                        maximum: 6
                        example: 3
                      quantity:
                        type: integer
                        minimum: 0
                        example: 60
                discountRate:
                  type: integer
                  minimum: 0
                  maximum: 100
                  nullable: true
                  example: 30
                discountStartTime:
                  type: string
                  format: date-time
                  nullable: true
                  example: "2025-01-10T00:00:00.000Z"
                discountEndTime:
                  type: string
                  format: date-time
                  nullable: true
                  example: "2025-01-20T23:59:59.999Z"
      responses:
        '200':
          description: 상품 수정 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    example: "cm4abc123def456ghi789jkl"
                  storeId:
                    type: string
                    example: "cmjtkn0td0017p701tp5nwslg"
                  categoryId:
                    type: string
                    example: "category_fashion_outer"
                  name:
                    type: string
                    example: "코디잇 프리미엄 오버핏 후드티"
                  price:
                    type: integer
                    example: 99000
                  content:
                    type: string
                    example: "겨울철 필수 아이템! 따뜻하고 편안한 프리미엄 오버핏 후드티입니다."
                  image:
                    type: string
                    example: "https://codiit-images.s3.ap-northeast-2.amazonaws.com/product-hoodie-updated.jpg"
                  discountRate:
                    type: integer
                    nullable: true
                    example: 30
                  discountStartTime:
                    type: string
                    format: date-time
                    nullable: true
                    example: "2025-01-10T00:00:00.000Z"
                  discountEndTime:
                    type: string
                    format: date-time
                    nullable: true
                    example: "2025-01-20T23:59:59.999Z"
                  createdAt:
                    type: string
                    format: date-time
                    example: "2025-01-05T08:30:00.000Z"
                  updatedAt:
                    type: string
                    format: date-time
                    example: "2025-01-05T15:45:00.000Z"
        '400':
          description: 유효성 검증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: "유효성 검증에 실패했습니다."
                details:
                  - field: "content"
                    message: "상품 상세 설명은 최소 10자 이상이어야 합니다."
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: "로그인이 필요합니다."
                details: []
        '403':
          description: 권한 없음 (본인의 상품이 아님)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: "본인의 상품만 수정할 수 있습니다."
                details: []
        '404':
          description: 상품 또는 카테고리를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                productNotFound:
                  value:
                    message: "상품을 찾을 수 없습니다."
                    details: []
                categoryNotFound:
                  value:
                    message: "카테고리를 찾을 수 없습니다."
                    details: []

    delete:
      tags:
        - Product
      summary: 상품 삭제
      description: |
        판매자가 자신의 상품을 삭제합니다.

        인증 필요:
        `Bearer 토큰 필수`

        권한:
        `SELLER` 전용

        주의사항:
        자신의 스토어 상품만 삭제할 수 있습니다.
        삭제된 상품은 복구할 수 없습니다.
        관련된 재고, 장바구니 항목 등도 함께 삭제됩니다.
      security:
        - bearerAuth: []
      parameters:
        - name: productId
          in: path
          required: true
          schema:
            type: string
          description: "상품 고유 ID"
          example: "cm4abc123def456ghi789jkl"
      responses:
        '204':
          description: 상품 삭제 성공 (응답 본문 없음)
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: "로그인이 필요합니다."
                details: []
        '403':
          description: 권한 없음 (본인의 상품이 아님)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: "본인의 상품만 삭제할 수 있습니다."
                details: []
        '404':
          description: 상품을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: "상품을 찾을 수 없습니다."
                details: []
